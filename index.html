<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laxman Nepal Gallery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header Styles */
        .header {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 16px;
        }
        
        .header-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .header-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Tab Bar */
        .tab-bar {
            display: flex;
            padding: 0 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: #000;
            position: sticky;
            top: 60px;
            z-index: 90;
        }
        
        .tab {
            padding: 14px 0;
            margin-right: 24px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.6);
            position: relative;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .tab.active {
            color: #fff;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #007aff;
            border-radius: 3px;
        }
        
        /* Content Area */
        .content {
            padding: 16px;
            padding-bottom: 80px;
        }
        
        /* Grid Views */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
        }
        
        .grid-item {
            aspect-ratio: 1;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            border-radius: 2px;
            transition: transform 0.2s;
        }
        
        .grid-item:active {
            transform: scale(0.95);
        }
        
        .grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .grid-item:hover img {
            transform: scale(1.05);
        }
        
        .folder-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            padding: 12px 8px 8px;
            color: #fff;
        }
        
        .folder-name {
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .image-count {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        /* Sort Menu */
        .sort-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1c1c1e;
            border-radius: 16px 16px 0 0;
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 16px;
            padding-bottom: 40px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .sort-menu.show {
            transform: translateY(0);
        }
        
        .sort-header {
            text-align: center;
            padding: 16px 0;
            font-weight: 600;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 16px;
        }
        
        .sort-close {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .sort-option {
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .sort-option:active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sort-option.active {
            color: #007aff;
        }
        
        .sort-direction {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            padding: 0 16px;
        }
        
        .direction-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .direction-btn.active {
            background: #007aff;
        }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .overlay.show {
            opacity: 1;
            pointer-events: all;
        }
        
        /* Image Viewer */
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .image-viewer.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .viewer-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        
        .image-viewer.show .viewer-image {
            transform: scale(1);
        }
        
        .viewer-close {
            position: absolute;
            top: 16px;
            left: 16px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
        }
        
        .viewer-nav {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 16px;
        }
        
        .nav-btn {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 2px;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state p {
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>Gallery</h1>
        <div class="header-actions">
            <button class="header-btn" id="search-btn">
                <i class="fas fa-search"></i>
            </button>
            <button class="header-btn" id="sort-btn">
                <i class="fas fa-sort"></i>
            </button>
        </div>
    </div>
    
    <!-- Tab Bar -->
    <div class="tab-bar">
        <div class="tab active" data-tab="all">All Photos</div>
        <div class="tab" data-tab="folders">Folders</div>
    </div>
    
    <!-- Content Area -->
    <div class="content">
        <!-- All Photos View -->
        <div class="grid-view" id="all-view">
            <!-- Photos will be dynamically added here -->
        </div>
        
        <!-- Folders View -->
        <div class="grid-view" id="folders-view" style="display: none;">
            <!-- Folders will be dynamically added here -->
        </div>
    </div>
    
    <!-- Sort Menu -->
    <div class="sort-menu" id="sort-menu">
        <div class="sort-header">
            Sort By
            <button class="sort-close" id="sort-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sort-option" data-sort="date">
            <span>Date</span>
            <i class="fas fa-check" style="display: none;"></i>
        </div>
        <div class="sort-option" data-sort="name">
            <span>Name</span>
            <i class="fas fa-check" style="display: none;"></i>
        </div>
        <div class="sort-option" data-sort="size">
            <span>Size</span>
            <i class="fas fa-check" style="display: none;"></i>
        </div>
        <div class="sort-direction">
            <button class="direction-btn active" data-dir="desc">Descending</button>
            <button class="direction-btn" data-dir="asc">Ascending</button>
        </div>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Image Viewer -->
    <div class="image-viewer" id="image-viewer">
        <button class="viewer-close" id="viewer-close">
            <i class="fas fa-times"></i>
        </button>
        <img class="viewer-image" id="viewer-image" src="" alt="">
        <div class="viewer-nav">
            <button class="nav-btn" id="prev-btn">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="nav-btn" id="next-btn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const allView = document.getElementById('all-view');
            const foldersView = document.getElementById('folders-view');
            const tabs = document.querySelectorAll('.tab');
            const sortBtn = document.getElementById('sort-btn');
            const sortMenu = document.getElementById('sort-menu');
            const sortClose = document.getElementById('sort-close');
            const overlay = document.getElementById('overlay');
            const sortOptions = document.querySelectorAll('.sort-option');
            const directionBtns = document.querySelectorAll('.direction-btn');
            const imageViewer = document.getElementById('image-viewer');
            const viewerImage = document.getElementById('viewer-image');
            const viewerClose = document.getElementById('viewer-close');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            // State variables
            let folders = [];
            let allImages = [];
            let currentImages = [];
            let currentImageIndex = 0;
            let currentSort = { by: 'date', dir: 'desc' };
            
            // GitHub repository information
            const username = 'LaxmanNepal';
            const repo = 'Laxman-Nepal-Photos';
            const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/`;
            
            // Initialize the app
            function init() {
                showSkeletonLoading();
                fetchFolders();
                setupEventListeners();
            }
            
            // Show skeleton loading UI
            function showSkeletonLoading() {
                allView.innerHTML = '';
                foldersView.innerHTML = '';
                
                // Add skeleton items
                for (let i = 0; i < 9; i++) {
                    const skeletonElement = document.createElement('div');
                    skeletonElement.className = 'grid-item skeleton';
                    allView.appendChild(skeletonElement);
                    foldersView.appendChild(skeletonElement.cloneNode(true));
                }
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Tab switching
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.getAttribute('data-tab');
                        switchTab(tabName);
                    });
                });
                
                // Sort menu
                sortBtn.addEventListener('click', showSortMenu);
                sortClose.addEventListener('click', hideSortMenu);
                overlay.addEventListener('click', hideSortMenu);
                
                // Sort options
                sortOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const sortBy = option.getAttribute('data-sort');
                        selectSortOption(sortBy);
                    });
                });
                
                // Direction buttons
                directionBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const direction = btn.getAttribute('data-dir');
                        selectDirection(direction);
                    });
                });
                
                // Image viewer
                viewerClose.addEventListener('click', closeImageViewer);
                prevBtn.addEventListener('click', showPrevImage);
                nextBtn.addEventListener('click', showNextImage);
                
                // Keyboard navigation
                document.addEventListener('keydown', function(e) {
                    if (imageViewer.classList.contains('show')) {
                        if (e.key === 'Escape') closeImageViewer();
                        if (e.key === 'ArrowLeft') showPrevImage();
                        if (e.key === 'ArrowRight') showNextImage();
                    }
                });
                
                // Swipe for image viewer
                let touchStartX = 0;
                let touchEndX = 0;
                
                viewerImage.addEventListener('touchstart', e => {
                    touchStartX = e.changedTouches[0].screenX;
                }, false);
                
                viewerImage.addEventListener('touchend', e => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe();
                }, false);
                
                function handleSwipe() {
                    if (touchEndX < touchStartX - 50) {
                        showNextImage();
                    }
                    if (touchEndX > touchStartX + 50) {
                        showPrevImage();
                    }
                }
            }
            
            // Switch between tabs
            function switchTab(tabName) {
                tabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                if (tabName === 'all') {
                    allView.style.display = 'grid';
                    foldersView.style.display = 'none';
                } else if (tabName === 'folders') {
                    allView.style.display = 'none';
                    foldersView.style.display = 'grid';
                }
            }
            
            // Show sort menu
            function showSortMenu() {
                sortMenu.classList.add('show');
                overlay.classList.add('show');
            }
            
            // Hide sort menu
            function hideSortMenu() {
                sortMenu.classList.remove('show');
                overlay.classList.remove('show');
            }
            
            // Select sort option
            function selectSortOption(sortBy) {
                currentSort.by = sortBy;
                
                // Update UI
                sortOptions.forEach(option => {
                    const optionSort = option.getAttribute('data-sort');
                    if (optionSort === sortBy) {
                        option.querySelector('i').style.display = 'block';
                    } else {
                        option.querySelector('i').style.display = 'none';
                    }
                });
                
                // Apply sorting
                sortImages();
                renderAllImages();
                renderFolders();
            }
            
            // Select sort direction
            function selectDirection(direction) {
                currentSort.dir = direction;
                
                // Update UI
                directionBtns.forEach(btn => {
                    const btnDirection = btn.getAttribute('data-dir');
                    if (btnDirection === direction) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Apply sorting
                sortImages();
                renderAllImages();
                renderFolders();
            }
            
            // Sort images based on current sort method
            function sortImages() {
                allImages.sort((a, b) => {
                    let valueA, valueB;
                    
                    if (currentSort.by === 'date') {
                        valueA = a.date || new Date(0);
                        valueB = b.date || new Date(0);
                    } else if (currentSort.by === 'name') {
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                    } else if (currentSort.by === 'size') {
                        valueA = a.size;
                        valueB = b.size;
                    }
                    
                    if (currentSort.dir === 'asc') {
                        return valueA > valueB ? 1 : -1;
                    } else {
                        return valueA < valueB ? 1 : -1;
                    }
                });
                
                // Also sort folders
                folders.sort((a, b) => {
                    let valueA, valueB;
                    
                    if (currentSort.by === 'date') {
                        valueA = a.date || new Date(0);
                        valueB = b.date || new Date(0);
                    } else if (currentSort.by === 'name') {
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                    } else if (currentSort.by === 'size') {
                        valueA = a.images.reduce((sum, img) => sum + img.size, 0);
                        valueB = b.images.reduce((sum, img) => sum + img.size, 0);
                    }
                    
                    if (currentSort.dir === 'asc') {
                        return valueA > valueB ? 1 : -1;
                    } else {
                        return valueA < valueB ? 1 : -1;
                    }
                });
            }
            
            // Fetch folders from GitHub repository
            async function fetchFolders() {
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error('Failed to fetch repository contents');
                    
                    const data = await response.json();
                    
                    // Filter out non-folder items and .github folder
                    const folderPromises = data
                        .filter(item => item.type === 'dir' && item.name !== '.github')
                        .map(async folder => {
                            try {
                                // Get folder contents to count images and get a thumbnail
                                const folderResponse = await fetch(folder.url);
                                if (!folderResponse.ok) throw new Error('Failed to fetch folder contents');
                                
                                const folderData = await folderResponse.json();
                                
                                // Filter image files
                                const images = folderData
                                    .filter(item => 
                                        item.type === 'file' && 
                                        /\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(item.name)
                                    )
                                    .map(item => ({
                                        url: item.download_url,
                                        name: item.name,
                                        size: item.size,
                                        path: item.path
                                    }));
                                
                                // Get date from the first image (approximation)
                                let folderDate = new Date(0);
                                if (images.length > 0) {
                                    // Use the current date as a fallback
                                    folderDate = new Date();
                                }
                                
                                return {
                                    name: folder.name,
                                    imageCount: images.length,
                                    thumbnail: images[0]?.url || 'https://via.placeholder.com/300/1a1a1a/666666?text=No+Images',
                                    images: images,
                                    date: folderDate
                                };
                            } catch (error) {
                                console.error(`Error processing folder ${folder.name}:`, error);
                                return {
                                    name: folder.name,
                                    imageCount: 0,
                                    thumbnail: 'https://via.placeholder.com/300/1a1a1a/666666?text=Error',
                                    images: [],
                                    date: new Date(0)
                                };
                            }
                        });
                    
                    folders = await Promise.all(folderPromises);
                    
                    // Collect all images for the "All Photos" view
                    allImages = [];
                    folders.forEach(folder => {
                        folder.images.forEach(image => {
                            allImages.push({
                                ...image,
                                folder: folder.name,
                                date: folder.date
                            });
                        });
                    });
                    
                    // Sort and render
                    sortImages();
                    renderAllImages();
                    renderFolders();
                } catch (error) {
                    console.error('Error fetching repository:', error);
                    showErrorState();
                }
            }
            
            // Show error state
            function showErrorState() {
                allView.innerHTML = '';
                foldersView.innerHTML = '';
                
                const errorElement = document.createElement('div');
                errorElement.className = 'empty-state';
                errorElement.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Failed to load content. Please try again later.</p>
                `;
                
                allView.appendChild(errorElement);
                foldersView.appendChild(errorElement.cloneNode(true));
            }
            
            // Render all images
            function renderAllImages() {
                allView.innerHTML = '';
                
                if (allImages.length === 0) {
                    const emptyElement = document.createElement('div');
                    emptyElement.className = 'empty-state';
                    emptyElement.innerHTML = `
                        <i class="fas fa-camera"></i>
                        <p>No photos found</p>
                    `;
                    allView.appendChild(emptyElement);
                    return;
                }
                
                allImages.forEach((image, index) => {
                    const imageElement = document.createElement('div');
                    imageElement.className = 'grid-item fade-in';
                    imageElement.innerHTML = `
                        <img src="${image.url}" alt="${image.name}" loading="lazy">
                    `;
                    
                    imageElement.addEventListener('click', () => {
                        openImageViewer(index, allImages);
                    });
                    
                    allView.appendChild(imageElement);
                });
            }
            
            // Render folders
            function renderFolders() {
                foldersView.innerHTML = '';
                
                if (folders.length === 0) {
                    const emptyElement = document.createElement('div');
                    emptyElement.className = 'empty-state';
                    emptyElement.innerHTML = `
                        <i class="fas fa-folder"></i>
                        <p>No folders found</p>
                    `;
                    foldersView.appendChild(emptyElement);
                    return;
                }
                
                folders.forEach((folder, index) => {
                    if (folder.name === '.github') return; // Skip .github folder
                    
                    const folderElement = document.createElement('div');
                    folderElement.className = 'grid-item fade-in';
                    folderElement.innerHTML = `
                        <img src="${folder.thumbnail}" alt="${folder.name}" loading="lazy">
                        <div class="folder-info">
                            <div class="folder-name">${folder.name}</div>
                            <div class="image-count">${folder.imageCount} photos</div>
                        </div>
                    `;
                    
                    folderElement.addEventListener('click', () => {
                        openFolderView(index);
                    });
                    
                    foldersView.appendChild(folderElement);
                });
            }
            
            // Open folder view
            function openFolderView(folderIndex) {
                const folder = folders[folderIndex];
                currentImages = folder.images;
                
                // Update UI to show folder contents in all view
                allView.innerHTML = '';
                
                if (currentImages.length === 0) {
                    const emptyElement = document.createElement('div');
                    emptyElement.className = 'empty-state';
                    emptyElement.innerHTML = `
                        <i class="fas fa-camera"></i>
                        <p>No photos in this folder</p>
                    `;
                    allView.appendChild(emptyElement);
                    return;
                }
                
                currentImages.forEach((image, index) => {
                    const imageElement = document.createElement('div');
                    imageElement.className = 'grid-item fade-in';
                    imageElement.innerHTML = `
                        <img src="${image.url}" alt="${image.name}" loading="lazy">
                    `;
                    
                    imageElement.addEventListener('click', () => {
                        openImageViewer(index, currentImages);
                    });
                    
                    allView.appendChild(imageElement);
                });
                
                // Switch to all view tab
                switchTab('all');
                
                // Update header to show folder name
                document.querySelector('.header h1').textContent = folder.name;
            }
            
            // Open image viewer
            function openImageViewer(index, images) {
                currentImages = images;
                currentImageIndex = index;
                viewerImage.src = currentImages[currentImageIndex].url;
                imageViewer.classList.add('show');
                
                // Prevent body scrolling
                document.body.style.overflow = 'hidden';
            }
            
            // Close image viewer
            function closeImageViewer() {
                imageViewer.classList.remove('show');
                
                // Allow body scrolling
                document.body.style.overflow = 'auto';
            }
            
            // Show next image
            function showNextImage() {
                currentImageIndex = (currentImageIndex + 1) % currentImages.length;
                viewerImage.src = currentImages[currentImageIndex].url;
            }
            
            // Show previous image
            function showPrevImage() {
                currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
                viewerImage.src = currentImages[currentImageIndex].url;
            }
            
            // Initialize the app
            init();
        });
    </script>
</body>
</html>
